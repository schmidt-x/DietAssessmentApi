# DietAssessmentApi (test assignment)

## Содержание

- [Тестовое задание](#тестовое-задание)
	- [Описание](#описание)
	- [Задача](#задача)
	- [Реализация и технические детали](#реализация-и-технические-детали)
		- [Структура бд](#структура-бд)
		- [Структура домена](#структура-домена)
		- [Структура Http-ответа](#структура-http-ответа)
- [Локальный запуск приложения](#локальный-запуск-приложения)

## Тестовое задание

### Описание

В мобильном приложении Биогеном (ссылки для скачивания в https://biogenom.ru/mob-app) пользователь может пройти оценку качества питания.

После регистрации в приложении к оценке качества питания с главной страницы можно перейти двумя способами:
1. На главной нажать «Пройти анкету» – Пройти быстро
2. На главной нажать «Диагностика» - «Оценка качества питания (краткая)» – «Пройти оценку»

После прохождения оценки, пользователю открывается Индивидуальный отчёт. Повторно его можно найти через «Главная» - «Диагностика» - «Оценка качества питания (краткая)» - «Узнать результаты».

### Задача

**Ваша задача** в предположениях что
1. результат обработки анкеты качества питания вам ранее отдала отдельная система и вы его сложили в БД как сами захотели;
2. запросы на серверную часть отправляются от лица единственного пользователя и проверять его авторизацию не требуется (результат хранится только про одного пользователя и только за последнее прохождение);
3. PostgreSQL полностью соответствует модели данных, выраженной в классах EF Core, миграции создавать не надо;

**реализовать** без Minimal API и top-level statements Web API проект, который бы предоставлял API для реализации запросов для такой страницы. Данные должны браться из PostgreSQL через EF Core. Если есть непонимание где как лучше сделать и почему, сделайте на своё усмотрение.

### Реализация и технические детали

#### Структура бд

![scheme](./media/db%20scheme.png)

#### Структура домена

```cs
class Nutrient { // Питательное вещество
  int Id
  string Name                   // Наименование нутриента (например, Белки, Железо, Витамин C, и т.д.)
  double? RecommendedIntakeFrom // Рекомендуемая норма потребления, нижняя граница
  double RecommendedIntakeTo    // Рекомендуемая норма потребления, верхняя граница
  Unit Unit                     // Единица измерения (например, G (г), Mg (мг), Mcg (мкг), Kcal (ккал))
}
```

```cs
class NutrientReport { // Отчет о потреблении нутриентов
  int Id
  double Intake            // Фактическое потребление
  double RecFromFood       // Рекомендованное дополнительное потребление из обычного питания для компенсации дефицита
  double RecFromSupplement // Рекомендованное дополнительное потребление из БАДов для компенсации дефицита
  int NutrientId           // Внешний ключ на Nutrient -> Id
  Nutrient Nutrient        // Навигационное свойство на таблицу Nutrient
}
```

```csharp
class Supplement { // Пищевая добавка
  int Id
  string Name                       // Наименование добавки
  string ThumbnailUrl               // Ссылка на изображение-превью
  IReadOnlyList<Nutrient> Nutrients // Навигационное свойство на таблицу Nutrient
}
```

#### Структура Http-ответа

```json
{
  "reports": [
    {
      "id": 1,
      "intake": 6.50,
      "recFromFood": 7,
      "recFromSupplement": 14,
      "isDeficient": true,
      "nutrient": {
        "id": 1,
        "name": "Железо",
        "recommendedIntakeFrom": 10,
        "recommendedIntakeTo": 45,
        "unit": "Mg"
      }
    }
  ],
  "supplements": [
    {
      "id": 1,
      "name": "Supplement 1",
      "thumbnailUrl": "link/to/thumbnail"
    }
  ]
}
```

## Локальный запуск приложения

Чтобы запустить приложение используя Docker, нужно:
1. Склонировать репозиторий
	```sh
	git clone https://github.com/schmidt-x/DietAssessmentApi.git
	```
2. Создать `.env` на основе `.env.example` и заменить значения на желаемые
3. Выполнить следующую команду в корневой папке репозитория
	```sh
	docker compose up -d
	```
4. Перейти по ссылке http://localhost:8080/swagger (`8080` — дефолтный порт из переменной `API_PORT` в `.env.example`)

Или попробуйте уже запущенный экземпляр приложения: http://diet-api.schtefan.xyz/